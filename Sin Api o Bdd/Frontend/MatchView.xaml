<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:components="clr-namespace:Frontend.Resources.Components"
             x:Class="Frontend.MatchView"
             x:Name="matchViewInstance"
             Title="Vista de Partido">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">

            <!-- Título del partido -->
            <Label x:Name="lblMatchViewTitle" 
                   FontSize="24" 
                   FontAttributes="Bold" 
                   HorizontalOptions="Center" />

            <Label x:Name="lblTournament" 
                   FontSize="18" 
                   FontAttributes="Italic" 
                   HorizontalOptions="Center" 
                   TextColor="Gray" />

            <!-- Encabezado de equipos -->
            <Grid ColumnSpacing="10" Padding="10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="2*" />
                </Grid.ColumnDefinitions>

                <Label Grid.Column="0" x:Name="lblTeamLocal" 
                       FontSize="18" 
                       FontAttributes="Bold" 
                       HorizontalOptions="Center" />

                <Label Grid.Column="2" Text="Score A" 
                       FontAttributes="Bold" 
                       HorizontalOptions="Center" />

                <Label Grid.Column="3" Text="Score B" 
                       FontAttributes="Bold" 
                       HorizontalOptions="Center" />

                <Label Grid.Column="5" x:Name="lblTeamAway" 
                       FontSize="18" 
                       FontAttributes="Bold" 
                       HorizontalOptions="Center" />
            </Grid>

            <!-- Subtítulos de la tabla -->
            <Grid ColumnSpacing="10" Padding="10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="1*" />
                    <ColumnDefinition Width="250" />
                    <ColumnDefinition Width="250" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="1*" />
                </Grid.ColumnDefinitions>

                <Label 
                    Grid.Column="0" Text="N°"
                    FontAttributes="Bold" 
                    HorizontalOptions="Center" />

                <Label Grid.Column="1" Text="Nombre Jugador Local" 
                       FontAttributes="Bold" 
                       HorizontalOptions="Center" />

                <Picker x:Name="pckLocalActions"
                        Grid.Column="2" 
                        Title="Acción" 
                        HorizontalOptions="Center" 
                        SelectedIndexChanged="OnLocalPickerSelectedIndexChanged">
                    <Picker.ItemsSource>
                        <x:Array Type="{x:Type x:String}">
                            <x:String>Goal</x:String>
                            <x:String>Save</x:String>
                            <x:String>Miss</x:String>
                            <x:String>Blocked</x:String>
                            <x:String>Steal_W</x:String>
                            <x:String>Steal_L</x:String>
                            <x:String>Foul</x:String>
                        </x:Array>
                    </Picker.ItemsSource>
                </Picker>
                <Picker x:Name="pckAwayActions"
                        Grid.Column="3" 
                        Title="Acción" 
                        HorizontalOptions="Center"
                        SelectedIndexChanged="OnAwayPickerSelectedIndexChanged">
                    <Picker.ItemsSource>
                        <x:Array Type="{x:Type x:String}">
                            <x:String>Goal</x:String>
                            <x:String>Save</x:String>
                            <x:String>Miss</x:String>
                            <x:String>Blocked</x:String>
                            <x:String>Steal_W</x:String>
                            <x:String>Steal_L</x:String>
                            <x:String>Foul</x:String>
                        </x:Array>
                    </Picker.ItemsSource>
                </Picker>

                <Label 
                    Grid.Column="4" Text="N°" 
                    FontAttributes="Bold" 
                    HorizontalOptions="Center" />
                
                <Label Grid.Column="5" Text="Nombre Jugador Visitante" 
                       FontAttributes="Bold" 
                       HorizontalOptions="Center" />
            </Grid>

            <!-- Filas dinámicas de jugadores -->
            <Grid ColumnSpacing="10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="1*" />
                    <ColumnDefinition Width="250" />
                    <ColumnDefinition Width="250" />
                    <ColumnDefinition Width="1*" />
                </Grid.ColumnDefinitions>

                <!-- Jugadores locales -->
                <StackLayout 
                        x:Name="PlayerListLocal" 
                        BindableLayout.ItemsSource="{Binding TeamLocalPlayers}"
                        Grid.Column="0"
                        HorizontalOptions="FillAndExpand" VerticalOptions="FillAndExpand">
                    <StackLayout.Triggers>
                        <DataTrigger TargetType="StackLayout" Binding="{Binding TeamLocalPlayers.Count}" Value="0">
                            <Setter Property="IsVisible" Value="False" />
                        </DataTrigger>
                    </StackLayout.Triggers>
                    <BindableLayout.ItemTemplate>
                        <DataTemplate>
                            <components:PlayerItemView MatchView="{Binding Source={x:Reference matchViewInstance}}" Player="{Binding .}" />
                        </DataTemplate>
                    </BindableLayout.ItemTemplate>
                </StackLayout>

                <StackLayout 
                    x:Name="LabelListLocal" 
                    BindableLayout.ItemsSource="{Binding TeamLocalPlayers}"
                    Grid.Column="1">
                    <StackLayout.Triggers>
                        <DataTrigger TargetType="StackLayout" Binding="{Binding TeamLocalPlayers.Count}" Value="0">
                            <Setter Property="IsVisible" Value="False" />
                        </DataTrigger>
                    </StackLayout.Triggers>
                    <BindableLayout.ItemTemplate>
                        <DataTemplate>
                            <Label Text="{Binding ActionCountLocal}" />
                        </DataTemplate>
                    </BindableLayout.ItemTemplate>
                </StackLayout>

                <!-- Mensaje de jugadores locales vacíos -->
                <StackLayout IsVisible="False"
                             Grid.Column="0">
                    <StackLayout.Triggers>
                        <DataTrigger TargetType="StackLayout" Binding="{Binding TeamLocalPlayers.Count}" Value="0">
                            <Setter Property="IsVisible" Value="True" />
                        </DataTrigger>
                    </StackLayout.Triggers>
                    <Label x:Name="lblMessageLocalEmptyPlayers"
                           Text="No hay jugadores del equipo local cargados aún."
                           TextColor="Red" />
                </StackLayout>

                <!-- Jugadores visitantes -->
                <StackLayout 
                        x:Name="PlayerListAway" 
                        BindableLayout.ItemsSource="{Binding TeamAwayPlayers}"
                        Grid.Column="3"
                        HorizontalOptions="FillAndExpand" VerticalOptions="FillAndExpand">
                    <StackLayout.Triggers>
                        <DataTrigger TargetType="StackLayout" Binding="{Binding TeamAwayPlayers.Count}" Value="0">
                            <Setter Property="IsVisible" Value="False" />
                        </DataTrigger>
                    </StackLayout.Triggers>
                    <BindableLayout.ItemTemplate>
                        <DataTemplate>
                            <components:PlayerItemView MatchView="{Binding Source={x:Reference matchViewInstance}}" Player="{Binding .}" />
                        </DataTemplate>
                    </BindableLayout.ItemTemplate>
                </StackLayout>

                <StackLayout 
                    x:Name="LabelListAway" 
                    BindableLayout.ItemsSource="{Binding TeamAwayPlayers}"
                    Grid.Column="4">
                    <StackLayout.Triggers>
                        <DataTrigger TargetType="StackLayout" Binding="{Binding TeamAwayPlayers.Count}" Value="0">
                            <Setter Property="IsVisible" Value="False" />
                        </DataTrigger>
                    </StackLayout.Triggers>
                    <BindableLayout.ItemTemplate>
                        <DataTemplate>
                            <Label Text="{Binding ActionCountAway}" />
                        </DataTemplate>
                    </BindableLayout.ItemTemplate>
                </StackLayout>

                <!-- Mensaje de jugadores visitantes vacíos -->
                <StackLayout IsVisible="False"
                             Grid.Column="3">
                    <StackLayout.Triggers>
                        <DataTrigger TargetType="StackLayout" Binding="{Binding TeamAwayPlayers.Count}" Value="0">
                            <Setter Property="IsVisible" Value="True" />
                        </DataTrigger>
                    </StackLayout.Triggers>
                    <Label x:Name="lblMessageEmptyAwayPlayers"
                           Text="No hay jugadores del equipo visitante cargados aún."
                           TextColor="Red" />
                </StackLayout>
            </Grid>

            <!-- Botones de acción -->
            <HorizontalStackLayout Spacing="10" Padding="10">
                <Button x:Name="btnAddPlayer"
                        Text="Agregar jugador"
                        BackgroundColor="Blue"
                        TextColor="White"
                        Margin="10"
                        Clicked="OnAddPlayer" />

                <Button x:Name="btnCancel"
                        Text="Cancelar"
                        BackgroundColor="Red"
                        TextColor="White"
                        Margin="10"
                        Clicked="OnCancel" />

                <Button x:Name="btnFinish"
                        Text="Finalizar"
                        BackgroundColor="Green"
                        TextColor="White"
                        Margin="10"
                        Clicked="OnFinish" />
            </HorizontalStackLayout>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>